<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Devis Plaquiste Express</title>
  <!-- Tailwind CDN for quick, modern styling -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="max-w-3xl mx-auto p-6 bg-white shadow-xl rounded-2xl mt-8">
    <h1 class="text-2xl font-bold mb-6 text-center">Devis Plaquiste Express</h1>

    <!-- FORMULAIRE -->
    <form id="devisForm" class="space-y-4">
      <div class="flex flex-col">
        <label for="client" class="font-semibold">Nom du client</label>
        <input type="text" id="client" class="border rounded-md p-2" required />
      </div>

      <div class="flex flex-col">
        <label for="travaux" class="font-semibold">Type de travaux</label>
        <select id="travaux" class="border rounded-md p-2 bg-white" required>
          <option value="Cloison">Cloison</option>
          <option value="Faux plafond">Faux plafond</option>
          <option value="Isolation">Isolation</option>
          <option value="Autre">Autre</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div class="flex flex-col">
          <label for="surface" class="font-semibold">Surface (m²)</label>
          <input type="number" id="surface" class="border rounded-md p-2" required />
        </div>
        <div class="flex flex-col">
          <label for="tarif" class="font-semibold">Tarif (€/m² ou €/h)</label>
          <input type="number" id="tarif" class="border rounded-md p-2" required />
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div class="flex flex-col">
          <label for="tva" class="font-semibold">TVA (%)</label>
          <input type="number" id="tva" value="10" class="border rounded-md p-2" required />
        </div>
        <div class="flex flex-col">
          <label for="duree" class="font-semibold">Durée estimée (jours)</label>
          <input type="number" id="duree" class="border rounded-md p-2" required />
        </div>
      </div>

      <div class="flex flex-col">
        <label for="marge" class="font-semibold">Marge / frais divers (€)</label>
        <input type="number" id="marge" value="0" class="border rounded-md p-2" />
      </div>

      <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg transition-all">Calculer le devis</button>
    </form>

    <!-- RECAP -->
    <div id="recap" class="mt-8 hidden">
      <h2 class="text-xl font-bold mb-4">Récapitulatif</h2>
      <div class="border rounded-lg overflow-hidden">
        <table class="w-full text-left">
          <tbody>
            <tr class="border-b"><th class="p-2">Client</th><td id="recapClient" class="p-2"></td></tr>
            <tr class="border-b"><th class="p-2">Type de travaux</th><td id="recapTravaux" class="p-2"></td></tr>
            <tr class="border-b"><th class="p-2">Surface</th><td id="recapSurface" class="p-2"></td></tr>
            <tr class="border-b"><th class="p-2">Tarif unitaire</th><td id="recapTarif" class="p-2"></td></tr>
            <tr class="border-b"><th class="p-2">Durée estimée</th><td id="recapDuree" class="p-2"></td></tr>
            <tr class="border-b"><th class="p-2">Marge / frais</th><td id="recapMarge" class="p-2"></td></tr>
            <tr class="border-b font-semibold"><th class="p-2">Total HT</th><td id="recapHT" class="p-2"></td></tr>
            <tr class="border-b font-semibold"><th class="p-2">TVA</th><td id="recapTVA" class="p-2"></td></tr>
            <tr class="font-bold text-lg"><th class="p-2">Total TTC</th><td id="recapTTC" class="p-2"></td></tr>
          </tbody>
        </table>
      </div>

      <div class="flex flex-col sm:flex-row gap-4 mt-6">
        <button id="pdfBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white p-2 rounded-lg">Exporter en PDF</button>
        <!-- Section pro -->
        <button id="proBtn" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white p-2 rounded-lg hidden">Activer la version Pro</button>
      </div>
      
      <!-- email proposal -->
      <div class="mt-6">
        <label class="block font-semibold mb-1">Texte d'email prêt à copier :</label>
        <textarea id="emailText" class="w-full border rounded-md p-2 text-sm" rows="6" readonly></textarea>
      </div>
    </div>

    <!-- SECTION PRO MASQUÉE / LICENCE -->
    <div id="proSection" class="mt-8 hidden">
      <h3 class="text-lg font-semibold mb-2">Fonctionnalités Pro</h3>
      <ul class="list-disc list-inside text-sm space-y-1">
        <li>Enregistrement automatique de vos devis</li>
        <li>Bibliothèque de matériaux personnalisable</li>
        <li>Suivi des conversions et relances</li>
      </ul>
    </div>
  </div>

  <!-- jsPDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const logoBase64 = ""; // Remplacez par votre logo en base64 ou laissez vide.
    const isPro = false;    // Booléen pour activer les fonctions Pro. À relier à votre back-end / licence.

    const form = document.getElementById('devisForm');
    const recap = document.getElementById('recap');
    const proSection = document.getElementById('proSection');
    const proBtn = document.getElementById('proBtn');

    // Helper affichage euro
    const euro = v => new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(v);

    form.addEventListener('submit', e => {
      e.preventDefault();

      // Collecte des données
      const client  = document.getElementById('client').value.trim();
      const travaux = document.getElementById('travaux').value;
      const surface = parseFloat(document.getElementById('surface').value || 0);
      const tarif   = parseFloat(document.getElementById('tarif').value || 0);
      const tva     = parseFloat(document.getElementById('tva').value || 0);
      const duree   = parseFloat(document.getElementById('duree').value || 0);
      const marge   = parseFloat(document.getElementById('marge').value || 0);

      const totalHT  = surface * tarif + marge;
      const totalTVA = totalHT * (tva / 100);
      const totalTTC = totalHT + totalTVA;

      // Mise à jour récap
      document.getElementById('recapClient').textContent  = client;
      document.getElementById('recapTravaux').textContent = travaux;
      document.getElementById('recapSurface').textContent = `${surface} m²`;
      document.getElementById('recapTarif').textContent   = euro(tarif);
      document.getElementById('recapDuree').textContent   = duree + ' jours';
      document.getElementById('recapMarge').textContent   = euro(marge);
      document.getElementById('recapHT').textContent      = euro(totalHT);
      document.getElementById('recapTVA').textContent     = euro(totalTVA);
      document.getElementById('recapTTC').textContent     = euro(totalTTC);

      // Texte d'email prêt à copier
      const email = `Bonjour ${client},\n\nVeuillez trouver ci-dessous notre proposition pour les travaux de ${travaux} sur une surface de ${surface} m² :\n\n• Total HT : ${euro(totalHT)}\n• TVA (${tva}%) : ${euro(totalTVA)}\n• Total TTC : ${euro(totalTTC)}\n\nLa durée estimée du chantier est de ${duree} jours.\n\nRestant à votre disposition pour toute question,\nCordialement,\n[Votre société]`;
      document.getElementById('emailText').value = email;

      recap.classList.remove('hidden');
      if (isPro) { proSection.classList.remove('hidden'); } else { proBtn.classList.remove('hidden'); }
    });

    // PDF generation
    document.getElementById('pdfBtn').addEventListener('click', () => {
      const { jsPDF } = window.jspdf; // correction : déstructuration correcte
      const doc = new jsPDF();
      let y = 20;

      // Logo si disponible
      if (logoBase64) {
        doc.addImage(logoBase64, 'PNG', 150, 10, 40, 20);
      }

      doc.setFontSize(18);
      doc.text('DEVIS', 10, y);
      y += 10;

      doc.setFontSize(12);
      doc.text(`Client : ${document.getElementById('recapClient').textContent}`, 10, y); y += 7;
      doc.text(`Type de travaux : ${document.getElementById('recapTravaux').textContent}`, 10, y); y += 7;
      doc.text(`Surface : ${document.getElementById('recapSurface').textContent}`, 10, y); y += 7;
      doc.text(`Tarif unitaire : ${document.getElementById('recapTarif').textContent}`, 10, y); y += 7;
      doc.text(`Durée estimée : ${document.getElementById('recapDuree').textContent}`, 10, y); y += 7;
      doc.text(`Marge / frais : ${document.getElementById('recapM').textContent}`, 10, y); y += 7;A
